
Prompt_2 – Logikai Felépítés (Epubly.hu - Advanced Logic)

Az alkalmazás üzleti logikáját ES6 modulokra bontva, a `js/modules/` mappában kell megvalósítani.

Modul Struktúra és Specifikus Logika:

1. `engine.js` (Core Rendering):
   - **EPUB:** Infinite Scroll megvalósítás. A következő fejezet betöltése automatikusan elindul, ha a felhasználó 4000px-re megközelíti az oldal alját.
   - **PDF:** "Buffering" stratégia. Az aktuális oldal renderelésekor a rendszer előtölti az előtte és utána lévő 3-3 oldalt (canvas), hogy görgetéskor ne legyen fehér villanás.
   - **Prepend:** Felfelé görgetéskor az előző fejezet beszúrása és a görgetési pozíció korrekciója, hogy a nézet ne ugráljon.

2. `toc.js` (Tartalomjegyzék):
   - **Instant Back-Scroll:** Ha a felhasználó egy fejezetre ugrik, a rendszer nem csak azt, hanem az *előző* fejezetet is azonnal rendereli a DOM-ba (a látható terület fölé), így azonnal lehet visszafelé is görgetni.

3. `storage.js` (Perzisztencia):
   - **Metadata:** EPUB importáláskor a `dc:description` és a borítókép (Base64) kinyerése és mentése IndexedDB-be.
   - **Progress:** Olvasási pozíció és statisztikák (eltöltött idő) automatikus mentése.

4. `ui.js` (Interakciók):
   - Globális eseménykezelés (Delegation).
   - "Tegező" (informal) nyelvezet minden üzenetben.
   - PDF lebegő vezérlők kezelése.

5. `reader_settings.js` (Megjelenés):
   - **Global Zoom:** Egyetlen szorzó, ami skálázza a betűméretet, sorközt és betűközt is.
   - **Dynamic Margins:** Nagyításkor a margók dinamikus csökkentése a helykihasználás érdekében.

További modulok: `state.js` (adattároló), `library.js` (grid nézet), `settings.js` (localStorage config), `navigation.js` (history API), `search.js` (kliens oldali keresés), `utils.js`.

Ez a második lépés. A logika a fenti, teljesítményre optimalizált elveket kövesse.
